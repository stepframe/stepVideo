/**
 * stepVideo (Version 1.0)
 * Handles tracking of events in google analytics and fallback to flash player if needed.
 */
var stepVideo=function(){"use strict";function c(c){c&&(b.aspectRatio=c.aspectRatio||9/16,b.flashPlayerLocation=c.flashPlayerLocation||"/js/vendor/jwplayer/player.swf"),console.log(b),a?d():e()}function d(){function d(a){console.log("play handler: ",a.target.id),trackThis.event("Video",a.target.id,"VIDEO")}function e(){this.width=this.parentNode.offsetWidth,this.height=this.width*b.aspectRatio}function f(){var a;try{a=$(this).parents(".popup").find(".js-popup-close"),a.click()}catch(b){}}var a,c=document.querySelectorAll("video");for(a=0;a<c.length;a++)c[a]&&(c[a].addEventListener("play",d),c[a].addEventListener("loadedmetadata",e,!1),c[a].addEventListener("webkitendfullscreen",f),c[a].width=c[a].parentNode.offsetWidth,c[a].height=c[a].width*b.aspectRatio)}function e(){function k(){trackThis.event("Video",this.id,"VIDEO")}var a,e,f,g,h,i,c=570,d=1e3,j=document.querySelectorAll("video");for(a=0;a<j.length;a++)i=j[a].parentNode.offsetWidth,e=j[a].getElementsByTagName("source")[0].getAttribute("src"),f=j[a].getAttribute("poster"),g=i>c?i:c,g>d&&(g=d),h=b.aspectRatio*g,e&&(console.log("setting up ",j[a].getAttribute("id")),jwplayer(j[a].getAttribute("id")).setup({width:g,height:h,flashplayer:b.flashPlayerLocation,file:e,image:f}));for(a=0;a<jwplayer.getPlayers().length;a++)jwplayer.getPlayers()[a].onPlay(k)}var a=!!document.createElement("video").canPlayType,b={};return{init:c,hasHtmlVideo:a}}();
